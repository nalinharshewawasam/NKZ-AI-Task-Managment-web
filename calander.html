<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMaster Ultra | Full Suite</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; background: #f1f5f9; }

        .glass-sidebar { background: rgba(15, 23, 42, 0.98); backdrop-filter: blur(15px); border-right: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.6); transition: 0.3s; }
        
        .drawer { transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .drawer.active { transform: translateX(0); }
        
        #bg-canvas { position: fixed; top: 0; left: 0; z-index: -1; }
        .nav-active { background: #2563eb !important; color: white !important; }

        /* Calendar Styles */
        .calendar-day { min-height: 100px; transition: 0.2s; border: 1px solid #f1f5f9; }
        .calendar-day:hover { background: #eff6ff; }
        .today-circle { background: #2563eb; color: white; border-radius: 50%; width: 28px; height: 28px; display: flex; items-center: center; justify-content: center; }
    </style>
</head>
<body class="text-slate-800">

    <canvas id="bg-canvas"></canvas>

    <div class="flex h-screen w-full relative z-10">
        
        <aside class="w-64 glass-sidebar text-white flex flex-col">
            <div class="p-8 flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg"><i class="fas fa-bolt"></i></div>
                <span class="text-xl font-bold tracking-tight">TaskMaster</span>
            </div>

            <nav class="flex-1 px-4 space-y-2">
                <button onclick="switchTab('board')" id="btn-board" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl nav-active transition">
                    <i class="fas fa-th-large"></i> <span>Dashboard</span>
                </button>
                <button onclick="switchTab('calendar')" id="btn-calendar" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/10 text-slate-400 transition">
                    <i class="fas fa-calendar-alt"></i> <span>Calendar</span>
                </button>
            </nav>
        </aside>

        <main class="flex-1 flex flex-col overflow-hidden">
            
            <header class="h-20 flex items-center justify-between px-8 bg-white/60 border-b border-slate-200">
                <h2 id="view-title" class="text-2xl font-bold text-slate-800">Project Board</h2>
                <div class="flex items-center gap-4">
                    <button onclick="manualRefresh()" class="w-10 h-10 flex items-center justify-center bg-white border rounded-2xl text-slate-400 hover:text-blue-600 shadow-sm">
                        <i id="sync-icon" class="fas fa-sync-alt"></i>
                    </button>
                    <button onclick="openCreateModal()" class="bg-slate-900 text-white px-6 py-2.5 rounded-2xl font-semibold shadow-xl flex items-center gap-2">
                        <i class="fas fa-plus"></i> Add Task
                    </button>
                </div>
            </header>

            <div id="stats-bar" class="px-8 py-4 flex gap-6 bg-white/40 border-b border-slate-200">
                <div class="glass-card px-6 py-3 rounded-2xl flex items-center gap-4">
                    <div class="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-xl flex items-center justify-center"><i class="fas fa-tasks"></i></div>
                    <div><p class="text-[10px] font-bold text-slate-400 uppercase">Total Tasks</p><h4 id="stat-total" class="text-xl font-bold">0</h4></div>
                </div>
                <div class="glass-card px-6 py-3 rounded-2xl flex items-center gap-4">
                    <div class="w-10 h-10 bg-green-100 text-green-600 rounded-xl flex items-center justify-center"><i class="fas fa-check-circle"></i></div>
                    <div><p class="text-[10px] font-bold text-slate-400 uppercase">Completed</p><h4 id="stat-done" class="text-xl font-bold">0</h4></div>
                </div>
            </div>

            <div id="board-view" class="flex-1 p-8 overflow-x-auto">
                <div class="flex gap-8 h-full min-w-[1000px]">
                    <div class="w-80">
                        <div class="flex justify-between mb-4 px-2 font-bold text-slate-500 text-xs uppercase">To Do <span id="count-todo" class="bg-slate-200 px-2 rounded">0</span></div>
                        <div id="col-todo" data-status="todo" class="kanban-column space-y-4"></div>
                    </div>
                    <div class="w-80">
                        <div class="flex justify-between mb-4 px-2 font-bold text-blue-600 text-xs uppercase">Doing <span id="count-doing" class="bg-blue-100 px-2 rounded">0</span></div>
                        <div id="col-doing" data-status="doing" class="kanban-column space-y-4"></div>
                    </div>
                    <div class="w-80">
                        <div class="flex justify-between mb-4 px-2 font-bold text-green-600 text-xs uppercase">Done <span id="count-done-col" class="bg-green-100 px-2 rounded">0</span></div>
                        <div id="col-done" data-status="done" class="kanban-column space-y-4"></div>
                    </div>
                </div>
            </div>

            <div id="calendar-view" class="hidden flex-1 p-8 overflow-y-auto">
                <div class="max-w-5xl mx-auto glass-card rounded-3xl shadow-2xl overflow-hidden">
                    <div class="p-6 bg-white flex justify-between items-center border-b">
                        <h3 id="calendar-month-year" class="text-2xl font-bold text-slate-800"></h3>
                        <div class="flex gap-3">
                            <button onclick="prevMonth()" class="p-2 bg-slate-100 hover:bg-blue-100 rounded-xl transition"><i class="fas fa-chevron-left"></i></button>
                            <button onclick="nextMonth()" class="p-2 bg-slate-100 hover:bg-blue-100 rounded-xl transition"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                    <div class="grid grid-cols-7 bg-slate-50 border-b text-center font-bold text-slate-400 text-xs py-4 uppercase tracking-widest">
                        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                    </div>
                    <div id="calendar-days-grid" class="grid grid-cols-7">
                        </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- DATA ---
        let tasks = JSON.parse(localStorage.getItem('tm_ultra_data')) || [
            { id: 1, title: 'Project Research', status: 'todo', date: new Date().toISOString().split('T')[0] }
        ];

        let currentDate = new Date();

        // --- CALENDAR LOGIC ---
        function renderCalendar() {
            const grid = document.getElementById('calendar-days-grid');
            const monthYear = document.getElementById('calendar-month-year');
            grid.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            monthYear.innerText = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            // Fill empty slots
            for (let i = 0; i < firstDay; i++) {
                grid.innerHTML += `<div class="calendar-day bg-slate-50/50"></div>`;
            }

            // Fill actual days
            for (let d = 1; d <= daysInMonth; d++) {
                const isToday = d === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                
                // Check if there are tasks for this day
                const dayTasks = tasks.filter(t => t.date === dateStr);
                let taskDots = dayTasks.map(t => `<div class="w-1.5 h-1.5 rounded-full bg-blue-500"></div>`).join('');

                grid.innerHTML += `
                    <div class="calendar-day p-3 bg-white flex flex-col items-start gap-2 border-r border-b">
                        <span class="${isToday ? 'today-circle' : 'text-slate-600 font-bold'} text-sm">${d}</span>
                        <div class="flex flex-wrap gap-1">${taskDots}</div>
                    </div>
                `;
            }
        }

        function prevMonth() { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); }
        function nextMonth() { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); }

        // --- TAB SWITCHING ---
        function switchTab(tab) {
            document.getElementById('board-view').classList.toggle('hidden', tab !== 'board');
            document.getElementById('calendar-view').classList.toggle('hidden', tab !== 'calendar');
            document.getElementById('view-title').innerText = tab === 'board' ? 'Project Board' : 'Schedule';
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active'));
            document.getElementById('btn-' + tab).classList.add('nav-active');

            if(tab === 'calendar') renderCalendar();
        }

        // --- KANBAN & STATS ---
        function renderTasks() {
            const cols = { todo: document.getElementById('col-todo'), doing: document.getElementById('col-doing'), done: document.getElementById('col-done') };
            Object.values(cols).forEach(c => c.innerHTML = '');

            tasks.forEach(task => {
                const card = document.createElement('div');
                card.className = "glass-card p-4 rounded-2xl cursor-pointer shadow-sm border border-slate-200";
                card.innerHTML = `<h4 class="font-bold text-slate-800 text-sm">${task.title}</h4>
                                  <p class="text-[10px] text-slate-400 mt-1 uppercase font-bold"><i class="far fa-calendar"></i> ${task.date || 'No Date'}</p>`;
                cols[task.status].appendChild(card);
            });
            updateStats();
            localStorage.setItem('tm_ultra_data', JSON.stringify(tasks));
        }

        function updateStats() {
            document.getElementById('stat-total').innerText = tasks.length;
            document.getElementById('stat-done').innerText = tasks.filter(t => t.status === 'done').length;
            document.getElementById('count-todo').innerText = tasks.filter(t => t.status === 'todo').length;
            document.getElementById('count-doing').innerText = tasks.filter(t => t.status === 'doing').length;
            document.getElementById('count-done-col').innerText = tasks.filter(t => t.status === 'done').length;
        }

        function manualRefresh() {
            const icon = document.getElementById('sync-icon');
            icon.classList.add('fa-spin');
            setTimeout(() => { renderTasks(); icon.classList.remove('fa-spin'); }, 800);
        }

        // Three.js BG Init
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        const sphere = new THREE.Mesh(new THREE.IcosahedronGeometry(15, 1), new THREE.MeshNormalMaterial({ wireframe: true, opacity: 0.05, transparent: true }));
        scene.add(sphere); camera.position.z = 40;
        function anim() { requestAnimationFrame(anim); sphere.rotation.y += 0.001; renderer.render(scene, camera); }
        anim();

        renderTasks();
    </script>
</body>
</html>